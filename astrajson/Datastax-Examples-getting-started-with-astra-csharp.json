{
    "key": "Datastax-Examples-getting-started-with-astra-csharp",
    "tags": [
        "labs",
        "c#",
        "dev"
    ],
    "urls": {
        "github": "https://github.com/DataStax-Examples/getting-started-with-astra-csharp"
    },
    "last_modified": "Thu, 03 Dec 2020 00:59:13 GMT",
    "forks_count": 5,
    "stargazers_count": 0,
    "name": "Getting Started with Cassandra + C# + Astra",
    "description": "This provides an example REST backend built in C# using .NET Core 2.1 for use with the Getting Started with Astra UI.",
    "duration": "50 minutes",
    "skilllevel": "Intermediate",
    "priority": 3,
    "readme": "<h1>Getting Started with Apache Cassandra\u2122 and C# using DataStax Astra</h1>\n<p>This provides an example REST backend built in C# using .NET Core 2.1 for use with the <a href=\"https://github.com/DataStax-Examples/getting-started-with-astra-ui\">Getting Started with Astra UI</a>.</p>\n<p>Create a free-forever Cassandra Database with DataStax Astra: <a href=\"https://astra.datastax.com/register?utm_source=devplay&amp;utm_medium=github&amp;utm_campaign=getting-started-with-astra-csharp\">click here to get started</a> \ud83d\ude80</p>\n<p>Contributors:</p>\n<ul>\n<li><a href=\"https://github.com/bechbd\">bechbd</a></li>\n<li><a href=\"https://github.com/msmygit\">msmygit</a></li>\n</ul>\n<h2>Objectives</h2>\n<ul>\n<li>How to connect to Astra via the Secure Connect Bundle</li>\n<li>How to manage a Cassandra Session within a .NET web application</li>\n</ul>\n<h2>Project Layout</h2>\n<p>This sample also contains several interesting files that worth noting specifically:</p>\n<ul>\n<li><a href=\"Services/AstraService.cs\">Services/AstraService.cs</a> - This file contains all the logic for connecting to the Astra database using the secure connect bundle.</li>\n<li><a href=\"Startup.cs\">Startup.cs</a> - This file contains the logic for adding a singleton for the Session object for reuse across our application.</li>\n</ul>\n<p>See <a href=\"https://docs.datastax.com/en/devapp/doc/devapp/driversBestPractices.html#Useasinglesessionobjectperapplication\">here</a> for additional details on how the session object in Cassandra works and why it is best practice to only have a single Session object per application</p>\n<ul>\n<li>\n<p><a href=\"schema.cql\">schema.cql</a> - The database schema required for the Astra keyspace</p>\n</li>\n<li>\n<p><a href=\"Controllers/InstrumentsController.cs\">Controllers/InstrumentController.cs</a> - If you would like to see how to implement paging in C# then this would be the place to look.  Paging in Cassandra is different than what you are likely used to so it is beneficial to read <a href=\"https://docs.datastax.com/en/devapp/doc/devapp/driversResultPaging.html\">this</a> article describing how paging works with Cassandra.</p>\n</li>\n</ul>\n<h2>How this Sample Works</h2>\n<p>This is am example .NET Core Web API backend for use with the Astra Getting Started UI which is found <a href=\"https://github.com/DataStax-Examples/getting-started-with-astra-ui\">here</a>.</p>\n<p>This application serves as the connection between the UI website and an underlying Astra database.</p>\n<p>It has Swagger installed so once it is running you can look at the Swagger UI here:</p>\n<p><code>http://localhost:5000/swagger/index.html#/</code></p>\n<h3>Connecting to Astra with a Secure Connect Bundle</h3>\n<p>To see how to connect to Astra using the Secure Connect Bundle you can look at the <code>ConnectToAstra()</code> method in <a href=\"Services/AstraService.cs\">Services/AstraService.cs</a>.  In this method you will find the code which:</p>\n<ol>\n<li>\n<p>Creates a <code>Cluster</code> instance using the builder.</p>\n<p><code>var session = Cluster.Builder()</code></p>\n</li>\n<li>\n<p>Specifies the local file path to the Secure Connect Bundle ZIP file that has been downloaded from your Astra Database.</p>\n<p><code>.WithCloudSecureConnectionBundle(secureConnectBundlePath)</code></p>\n</li>\n<li>\n<p>Set the username and password for your Astra Database</p>\n<p><code>.WithCredentials(username, password)</code></p>\n</li>\n<li>\n<p>Set the default Consistency Level to <code>LOCAL_QUORUM</code>.  <code>LOCAL_QUORUM</code> is the only supported consistency level for Astra queries.</p>\n<p><code>.WithQueryOptions(new QueryOptions().SetConsistencyLevel(ConsistencyLevel.LocalQuorum))</code></p>\n</li>\n<li>\n<p>Build the <code>Cluster</code> object then connect to your Astra database specifying the keyspace to use.</p>\n<p><code>.Build().Connect(keyspace);</code></p>\n</li>\n</ol>\n<p>Once you have completed all these steps you will now have a fully configured, connected, and ready to run CQL queries.</p>\n<h3>Managing Cassandra Session Within a .NET Web Application</h3>\n<p>Creation of <code>Session</code> objects within an application is an expensive process as they take awhile to initialize and become aware of the clusters topology.  Due to this it is a best practice to create a <code>Session</code> object once per application and reuse it throughout the entire lifetime of that application.  When building an ASP.NET Core application as shown this is easily supported through the use of singleton and .NET Core's built in Dependency Injection mechanisms.</p>\n<p>For our Web API endpoints we created a singleton instance of our <code>AstraService</code> object inside the <code>ConfigureServices()</code> method in <a href=\"Startup.cs\">Startup.cs</a> using the following code:</p>\n<p><code>services.AddSingleton(typeof(Interfaces.IDataStaxService), typeof(Services.AstraService));</code></p>\n<p>This code specifies that we are adding a singleton instance of <code>AstraService</code> for any dependency requiring ",
    "_id": "Datastax-Examples-getting-started-with-astra-csharp",
    "readme_markdown": "# Getting Started with Apache Cassandra\u2122 and C# using DataStax Astra \n\nThis provides an example REST backend built in C# using .NET Core 2.1 for use with the [Getting Started with Astra UI](https://github.com/DataStax-Examples/getting-started-with-astra-ui).\n\nCreate a free-forever Cassandra Database with DataStax Astra: [click here to get started](https://astra.datastax.com/register?utm_source=devplay&utm_medium=github&utm_campaign=getting-started-with-astra-csharp) \ud83d\ude80\n\nContributors:\n* [bechbd](https://github.com/bechbd)\n* [msmygit](https://github.com/msmygit)\n\n## Objectives\n* How to connect to Astra via the Secure Connect Bundle\n* How to manage a Cassandra Session within a .NET web application\n\n## Project Layout\n\nThis sample also contains several interesting files that worth noting specifically:\n\n* [Services/AstraService.cs](Services/AstraService.cs) - This file contains all the logic for connecting to the Astra database using the secure connect bundle.\n* [Startup.cs](Startup.cs) - This file contains the logic for adding a singleton for the Session object for reuse across our application.\n\nSee [here](https://docs.datastax.com/en/devapp/doc/devapp/driversBestPractices.html#Useasinglesessionobjectperapplication) for additional details on how the session object in Cassandra works and why it is best practice to only have a single Session object per application\n\n* [schema.cql](schema.cql) - The database schema required for the Astra keyspace\n  \n* [Controllers/InstrumentController.cs](Controllers/InstrumentsController.cs) - If you would like to see how to implement paging in C# then this would be the place to look.  Paging in Cassandra is different than what you are likely used to so it is beneficial to read [this](https://docs.datastax.com/en/devapp/doc/devapp/driversResultPaging.html) article describing how paging works with Cassandra. \n\n## How this Sample Works\n\nThis is am example .NET Core Web API backend for use with the Astra Getting Started UI which is found [here](https://github.com/DataStax-Examples/getting-started-with-astra-ui).\n\nThis application serves as the connection between the UI website and an underlying Astra database.  \n\nIt has Swagger installed so once it is running you can look at the Swagger UI here:\n\n```http://localhost:5000/swagger/index.html#/```\n\n### Connecting to Astra with a Secure Connect Bundle\nTo see how to connect to Astra using the Secure Connect Bundle you can look at the `ConnectToAstra()` method in [Services/AstraService.cs](Services/AstraService.cs).  In this method you will find the code which:\n\n1. Creates a `Cluster` instance using the builder.\n   \n    ```var session = Cluster.Builder()```\n\n2. Specifies the local file path to the Secure Connect Bundle ZIP file that has been downloaded from your Astra Database.  \n   \n   ```.WithCloudSecureConnectionBundle(secureConnectBundlePath)```\n3. Set the username and password for your Astra Database\n\n    ```.WithCredentials(username, password)```\n4. Set the default Consistency Level to `LOCAL_QUORUM`.  `LOCAL_QUORUM` is the only supported consistency level for Astra queries.\n   \n   ```.WithQueryOptions(new QueryOptions().SetConsistencyLevel(ConsistencyLevel.LocalQuorum))```\n5.  Build the `Cluster` object then connect to your Astra database specifying the keyspace to use.\n\n    ```.Build().Connect(keyspace);```\n\nOnce you have completed all these steps you will now have a fully configured, connected, and ready to run CQL queries. \n\n### Managing Cassandra Session Within a .NET Web Application\nCreation of `Session` objects within an application is an expensive process as they take awhile to initialize and become aware of the clusters topology.  Due to this it is a best practice to create a `Session` object once per application and reuse it throughout the entire lifetime of that application.  When building an ASP.NET Core application as shown this is easily supported through the use of singleton and .NET Core's built in Dependency Injection mechanisms.  \n\nFor our Web API endpoints we created a singleton instance of our `AstraService` object inside the `ConfigureServices()` method in [Startup.cs](Startup.cs) using the following code:\n\n`services.AddSingleton(typeof(Interfaces.IDataStaxService), typeof(Services.AstraService));`\n\nThis code specifies that we are adding a singleton instance of `AstraService` for any dependency requiring an object instantiating the `Interfaces.IDataStaxService` interface.\n\nTo use this within our controllers, we need to specify a property on the constructor of the controller that requires the `Interfaces.IDataStaxService` interface as shown below.\n\n`        \npublic CredentialsController(IDataStaxService service)\n        {\n            Service = service;\n        }\n        `\n\nWith each call to the `CredentialsController` the `AstraService` singleton we created at startup will be passed to the constructor.  This mechanism of dependency injection allows us a simple mechanism to use a single `Session` object throughout th"
}